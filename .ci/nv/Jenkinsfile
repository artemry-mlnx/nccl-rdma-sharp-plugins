podTemplate (
    cloud:'sc-ipp-blossom-prod',
    volumes: [persistentVolumeClaim(mountPath: '/sw-mellanox-storage', claimName: 'sw-mellanox-storage', readOnly: false)],
    containers: [containerTemplate(name: 'ubuntu1804', image: 'ubuntu:18.04', ttyEnabled: true, command: 'cat')]
) {
    environment {
        ARTEFACT_DIR                = "${WORKSPACE}/artefacts"
        NFS_WORKSPACE               = "${NFS_WORKSPACE_ROOT}/ml-nccl-rdma-sharp-plugins-pr/${BUILD_NUMBER}"
        NCCL_RDMA_SHARP_PLUGINS_DIR = "${NFS_WORKSPACE}/nccl-rdma-sharp-plugins"
        NCCL_TESTS_DIR              = "${NFS_WORKSPACE}/nccl-tests"
    }

    node(POD_LABEL) {
        stage('Build nccl-rdma-sharp-plugins') {
            container('ubuntu1804') {
                checkout scm
                echo 'Building nccl-rdma-sharp-plugins...'
                sh "ls -al /"
                sh "mkdir -p /sw-mellanox-storage/tmp"
                sh "ls -al /sw-mellanox-storage"
                sh "id"
                sh "pwd"
                sh "find ."
                echo "INFO: WORKSPACE = ${WORKSPACE}"
                sh "find ${WORKSPACE}"
                sh """#!/bin/bash
                    set -o pipefail
                    ${WORKSPACE}/.ci/build_nccl_rdma_sharp_plugins.sh 2>&1
                    """
            }
        }
    }
}
