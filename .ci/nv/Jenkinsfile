//podTemplate (cloud:'sc-ipp-blossom-prod') {
//    node(POD_LABEL) {
//        stage('Run shell') {
//            sh 'echo blossom hello world'
//        }
//    }
//}

podTemplate (cloud:'sc-ipp-blossom-prod', yaml : """
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: cuda
    image: nvidia/cuda
    command:
    - cat
    restartPolicy: Never
    tty: true
  nodeSelector:
    nodeType: cpu
    kubernetes.io/os: linux
"""
) {
    node(POD_LABEL) {
        stage('Build nccl-rdma-sharp-plugins') {
            container('cuda') {
                steps {
                    echo 'Building nccl-rdma-sharp-plugins...'
                    sh """#!/bin/bash
                        set -o pipefail
                        ${WORKSPACE}/.ci/build_nccl_rdma_sharp_plugins.sh 2>&1
                        """
                }
            }
        }
    }
}
