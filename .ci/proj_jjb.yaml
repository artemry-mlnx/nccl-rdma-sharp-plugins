- job:
    name: "nccl-plugins-pr"
    project-type: pipeline
    description: '<h1><font color="blue">Do NOT edit this job through the Web GUI !</font></h1><h1><font color="blue">Managed by SWX_CI project</font></h1>'
    concurrent: true
    sandbox: true
    parameters:
      - string:
          name: "sha1"
          default: "master"
          description: "Commit to be checked, usually controlled by PR"
      - string:
          name: "MLNX_OFED_VERSION"
          default: "5.2-0.6.3.0"
          description: "MLNX_OFED version - see https://www.mellanox.com/products/infiniband-drivers/linux/mlnx_ofed"
    properties:
      - github:
          # TODO debug
          #url: &nccl-plugins-pr_git_repository "https://github.com/Mellanox/nccl-rdma-sharp-plugins"
          url: &nccl-plugins-pr_git_repository "https://github.com/artemry-mlnx/nccl-rdma-sharp-plugins"
      - build-discarder:
          num-to-keep: 20
    triggers:
      - github-pull-request:
          cron: 'H/5 * * * *'
          trigger-phrase: '.*\bbot:retest\b.*'
          status-context: "nccl-plugins-pr"
          success-status: "Test PASSed."
          failure-status: "Test FAILed."
          error-status: "Test FAILed."
          status-add-test-results: true
          # mellanox-github
          auth-id: '549927eb-7f38-4a8f-997a-81dd63605782'
          org-list: [ "Mellanox" ]
          white-list: [ "swx-jenkins","swx-jenkins2","swx-jenkins3" ]
          allow-whitelist-orgs-as-admins: true
    pipeline-scm:
      scm:
        - git:
            url: *nccl-plugins-pr_git_repository
            # mellanox-github
            credentials-id: '549927eb-7f38-4a8f-997a-81dd63605782'
            branches: [ "${sha1}" ]
            shallow-clone: true
            refspec: "+refs/heads/*:refs/remotes/origin/* +refs/pull/*:refs/remotes/origin/pr/*"
            browser: githubweb
            browser-url: *nccl-plugins-pr_git_repository
      script-path: .ci/Jenkinsfile
